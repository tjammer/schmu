(external printi (fun int unit))

(type int_wrap {:dat int :b int :c int})

(type (test 'a) {:int_wrap 'a})

(type (mut 'a) {:wrapped& 'a})

(fun test_thing []
  (val test {:int_wrap {:dat 2 :b 0 :c 0}})
  (fun vector_loop [i]
    (if (= i 10)
      (.int_wrap test)
      (vector_loop (+ i 1))))
  (vector_loop 0))

(fun test_thing_mut []
  (val test& {:wrapped {:dat 2 :b 0 :c 0}})
  (fun vector_loop [i]
    (if (= i 10)
      ()
      (do
        (set &(.wrapped test) {:dat (+ (.dat (.wrapped test)) 1) :b 0 :c 0})
        (vector_loop (+ i 1)))))
  (vector_loop 0)
  (.wrapped test))

(-> (.dat (test_thing))
    printi)
(-> (.dat (test_thing_mut))
    printi)
