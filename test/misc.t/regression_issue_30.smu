(type v {:x float :y float :z float})

(external dot (fun v v float))
(external norm (fun v v))
(external scale (fun v float v))
(external maybe (fun unit bool))

(fun calc_acc [vel]
  (val vunit (if (>. (dot vel vel) 0.1)
              (norm vel)
              {:x 1.0 :y 0.0 :z 0.0}))
  (val acc_force 100.0)
  (val acc (cond
             (maybe) (scale vunit acc_force)
             (maybe) (scale vunit - (*. acc_force 3.0))
             (scale vunit 0.1)))
  acc)
