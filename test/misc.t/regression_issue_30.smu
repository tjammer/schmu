(type v {:x float :y float :z float})

(external dot (fun v v float))
(external norm (fun v v))
(external scale (fun v float v))
(external maybe (fun unit bool))

(defn calc_acc (vel)
  (def vunit (if (>. (dot vel vel) 0.1)
              (norm vel)
              {:x 1.0 :y 0.0 :z 0.0}))
  (def acc_force 100.0)
  (def acc (cond
             ((maybe) (scale vunit acc_force))
             ((maybe) (scale vunit - (*. acc_force 3.0)))
             (else (scale vunit 0.1))))
  acc)

(ignore calc_acc)
